# 1. Анализ текущей архитектуры
## 1.1 Идентификация существующих проблем
| id    | Описание                                                                                                                                          |
| ----- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1.1.1 | Деградация производительности сервиса MES при увеличении на него нагрузки                                                                         |
| 1.1.2 | Проблемы с доступностью компонентов системы вызывают проблемы с согласованностью статусов заказов, либо их потере                                 |
| 1.1.3 | В команде разработки не реализованы практики непрерывной интеграции (CI) и непрерывной поставки (CD). Релиз и тестирование осуществляется вручную |
## 1.2 Недостатки текущей архитектуры решения
| id    | Описание                                                                                                                                                    |
| ----- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1.2.1 | Сервисы "Shop API" и "CRM API" хранят данные в общей базе данных "Shop DB", что является антипаттерном Database per Service                                 |
| 1.2.2 | Бекэнд сервисы реализованы на одном инстансе, сбой или отказ которых не блокирует работу всей системы, но сервисы становятся недоступными для пользователей |
| 1.2.3 | Базы данных не реплицируются, в случае сбоя или при их отказе, будет заблокирована работа других компонентов и системы в целом                                  |
| 1.2.3 | Не реализован мониторинг и локализация ошибок возникающих при работе системы                                                                                |
| 1.2.4 | Не реализован api gateway для взаимодействия клиенстких приложений с бэк-энд сервисами                                                                      |
| 1.2.5 | Некорректно определены доменные области в сервисе MES API, математический расчет стоимости изделия выполняется в вместе с бизнес логикой сервиса            |
| 1.2.6 | Нарушены потоки данных в системе и дублирование функциональности, заказы могут быть добавлены асинхронно из сервиса SHOP API, а также созданы синхронно через сервис MES API |
# 2. Описание целевой архитектуры
[Схема целевой архитектуры](./puml/tobe.plantuml)
## 2.1 Шаги и стратегия миграции
Приоритеты:
1 - реализация в течении 6 месяцев;
2 - реализация в течении 12 месяцев;
3 - реализация в течении 18 месяцев
| id | Описание | Приоритет |
| --- | --- | --- |
| 2.1.1 | Разделение функциональности реализованной в сервисе MES API на две доменные области: управление изготовление заказами и расчет стоимости изделия. В текущем сервисе реализованном на языке C# останется и будет задейстован только функционал расчета стоимости, функционал по взаимодействию с приложением UI и бизнес-логика изготовления заказов будет реализован в новом сервисе, написанном на языке Java. Таким образом, задержки в ответе возникающие при расчете моделей не будут влиять на пользователей сервиса MES | 1 |
| 2.1.2 | Передача и сбор метрик, для реализация мониторинга сервисов CRM API, MES API, SHOP API. Выявление сервисов с наибольшей нагрузкой | 1 |
| 2.1.3 | Реализация трейсинга запросов с помощью инструмента Jaeger | 1 |
| 2.1.4 | Найм devops инженеров и реализация практики непрерывной интеграции (CI) и непрерывной поставки (CD) | 2 |
| 2.1.5 | Реализация сервиса API Gateway для возможности перенаправление входящих запросов от потребителей на целевой сервис MES API | 2 |
| 2.1.6 | Реализация (дублирование) для внешних потребителей методов размещения заказов и расчета стоимости изделия в сервисе SHOP API | 2 |
| 2.1.7 | Реализация кеширования данных о статусе изготовления заказов для сервиса MES API | 2 |
| 2.1.8 | Реализация асинхронного обмена событиями и данными через Apache Kafka. Данное решение позволит лучше справлятся с повышением нагрузки от сторонних сервисов, а также более отказоустойчевое решение для системы. В отличие от Kafka, RabbitMQ не хранит сообщения, что усложняет поиск необработанных заказов при локализации проблем в системе | 3 |
| 2.1.9 | Разработка и реализация автоматизированного тестирования | 3 |
| 2.1.10 | Миграция хранилища для загрузки 3D моделей изделий в облачное хранилище S3 Storage | 3 |