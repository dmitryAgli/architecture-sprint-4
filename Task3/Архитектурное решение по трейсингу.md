# Анализ системы в контексте планирования трейсинга
| Use Case                                              | Сервис                                                |
| ----------------------------------------------------- | ----------------------------------------------------- |
| Покупатель нажал на кнопку «Сделать заказ»            | Internet Shop -> Shop API -> Shop DB                  |
| Cистема посчитала стоимость заказа                    | MES API -> Messages Queue -> CRM API -> Shop DB       |
| Заказ подтверждён, его можно отдавать в производство. | CRM -> CRM API -> Messages Queue -> MES API -> MES DB |
| Оператор взял заказ в работу                          | MES -> MES API -> MES DB                              |
| Оператор выполнил заказ                               | MES -> MES API -> MES DB -> Messages Queue            |

## Cписок данных, которые должны попадать в трейсинг
- trace_id - id трейса
- span_id - id операции внтури трейса
- order_id - id заказа
- service_name - микросервис, проводящий операцию
- operation_name - текущая операция
- operation_duration - длительность операции
- operation_status - статус операции

# Мотивация
Когда мы обнаружим, что некоторые заказы в нашей системе теряются или выполняются медленно, мы хотим, чтобы наши инструменты наблюдения рассказали нам историю о том, что произошло с этим заказом.
Мы хотим иметь возможность получать ответы на такие вопросы:
- Через какие сервисы системы проходил запрос?
- Каким образом запрос был обработан в каждом сервисе?
- Если запросы были медленными, где были узкие места?
- Если заказ был потерян, то в каком сервисе произошла ошибка?

## Влияние внедрения инструментов наблюдения на метрики
| Метрика                 | Описание                       | Тип                |
| ----------------------- | ------------------------------ | ------------------ |
| Response time (latency) | Время ответа                   | Производительность |
| Number of HTTP 200      | Количество HTTP 200            | Производительность |
| Number of HTTP 500      | Количество HTTP 500            | Производительность |
| Number of orders        | Количество новых заказов       | Бизнес метрики     |
| Number of registered    | Количество новых пользователей | Бизнес метрики     |
| Average order amount    | Средняя сумма заказа           | Бизнес метрики     |

# Предлагаемое решение
[Модель решения](./model/jewerly_c4_model.drawio)

# Компромиссы
- Затраты на адаптацию кода приложений и сервисов для передачи трейсов в систему трейсинга

# Безопасность
- В трейсы передаются только те данные, которые необходимы для диагностики производительности приложений и сервисов  
- Скрыть конфиденциальную информацию, чтобы минимизировать риски
- Ограничивать доступ к Jaeger UI
