# 1. Мотивация добавления мониторинга в систему
1. Обеспечение выполнения SLA, те соглашения между бизнес-заказчиком и техническими специалистами, об измеримых показателях, таких как время безотказной работы, время реагирования, а также мерах ответственности с той или другой стороны.
2. Ведение и документирование незапланированных крактовременных инцидентов, группы инцидентов или долгосрочных сбоев.
3. Выявлять на ранних этапах проблемы в работе системы, которые могут привести к сбоям или отказам.
4. Прогнозировать поведение системы под разными нагрузками, чтобы заранее оптимизировать производительность.
5. Выявлять проблемы в работе системы, при релизе новых версий. Такой контроль нужен, чтобы оперативно откатить изменения в случае проблем

# 2. Выбор подхода к мониторингу
| Сервис         | Подход | Причина                                                                                                        |
| -------------- | ------ | -------------------------------------------------------------------------------------------------------------- |
| MES Calculator | USE    | Сервис используется для выполнения интенсивных математических вычислений, без возможности кеширования запросов |
| MES API        | RED    | Сервис предоставляет API интерфейс для пользователей приложения                                                |
| SHOP API       | RED    | Сервис предоставляет API интерфейс для пользователей приложения                                                |
| CRM API        | RED    | Сервис предоставляет API интерфейс для пользователей приложения                                                |

# 3. Выбор метрик
## Сервис SHOP API
| Метрика                           | Назначение                                    | Тип мониторинга    |
| --------------------------------- | --------------------------------------------- | ------------------ |
| CPU %                             | Процент использования CPU                     | Система            |
| Memory Utilisation                | Процент использования памяти                  | Система            |
| Kb tranferred (received)          | Количество переданных байт                    | Система            |
| Kb provided (sent)                | Количество переданных байт                    | Система            |
| Number of requests (RPS)          | Количество запросов в секунду                 | Производительность |
| Number of requests (RPS) per user | Количество запросов в секунду на пользователя | Производительность |
| Response time (latency)           | Время ответа                                  | Производительность |
| Number of HTTP 200                | Количество HTTP 200                           | Производительность |
| Number of HTTP 500                | Количество HTTP 500                           | Производительность |
| Number of simultanious sessions   | Количество одновременных сессий               | Производительность |
| Number of orders                  | Количество новых заказов                      | Бизнес метрики     |
| Number of registered              | Количество новых пользователей                | Бизнес метрики     |
| Average order amount              | Средняя сумма заказа                          | Бизнес метрики     |

## База данных SHOP DB
| Метрика               | Назначение                   | Тип мониторинга |
| --------------------- | ---------------------------- | --------------- |
| Memory Utilisation    | Процент использования памяти | Система         |
| Number of connections | Количество соединений        | Система         |
| Size of db instance   | Размер базы данных           | Система         |

## Сервис CRM API
| Метрика                           | Назначение                                    | Тип мониторинга    |
| --------------------------------- | --------------------------------------------- | ------------------ |
| CPU %                             | Процент использования CPU                     | Система            |
| Memory Utilisation                | Процент использования памяти                  | Система            |
| Kb tranferred (received)          | Количество переданных байт                    | Система            |
| Kb provided (sent)                | Количество переданных байт                    | Система            |
| Number of requests (RPS)          | Количество запросов в секунду                 | Производительность |
| Number of requests (RPS) per user | Количество запросов в секунду на пользователя | Производительность |
| Response time (latency)           | Время ответа                                  | Производительность |
| Number of HTTP 200                | Количество HTTP 200                           | Производительность |
| Number of HTTP 500                | Количество HTTP 500                           | Производительность |
| Number of simultanious sessions   | Количество одновременных сессий               | Производительность |
| Number of orders                  | Количество новых заказов                      | Бизнес метрики     |
| Number of registered              | Количество новых пользователей                | Бизнес метрики     |
| Average order amount              | Средняя сумма заказа                          | Бизнес метрики     |

## База данных CRM DB
| Метрика               | Назначение                   | Тип мониторинга |
| --------------------- | ---------------------------- | --------------- |
| Memory Utilisation    | Процент использования памяти | Система         |
| Number of connections | Количество соединений        | Система         |
| Size of db instance   | Размер базы данных           | Система         |

## Сервис MES API
| Метрика                           | Назначение                                    | Тип мониторинга    |
| --------------------------------- | --------------------------------------------- | ------------------ |
| CPU %                             | Процент использования CPU                     | Система            |
| Memory Utilisation                | Процент использования памяти                  | Система            |
| Kb tranferred (received)          | Количество переданных байт                    | Система            |
| Kb provided (sent)                | Количество переданных байт                    | Система            |
| Number of requests (RPS)          | Количество запросов в секунду                 | Производительность |
| Number of requests (RPS) per user | Количество запросов в секунду на пользователя | Производительность |
| Response time (latency)           | Время ответа                                  | Производительность |
| Number of HTTP 200                | Количество HTTP 200                           | Производительность |
| Number of HTTP 500                | Количество HTTP 500                           | Производительность |
| Number of simultanious sessions   | Количество одновременных сессий               | Производительность |
| Number of orders                  | Количество новых заказов                      | Бизнес метрики     |
| Number of registered              | Количество новых пользователей                | Бизнес метрики     |
| Average order amount              | Средняя сумма заказа                          | Бизнес метрики     |

## База данных MES DB
| Метрика               | Назначение                   | Тип мониторинга |
| --------------------- | ---------------------------- | --------------- |
| Memory Utilisation    | Процент использования памяти | Система         |
| Number of connections | Количество соединений        | Система         |
| Size of db instance   | Размер базы данных           | Система         |

## Система обмена сообщениями Apache Kafka
| Метрика              | Назначение               | Тип мониторинга    |
| -------------------- | ------------------------ | ------------------ |
| Topic size           | Размер топика            | Система            |
| Average message size | Средний размер сообщения | Система            |
| Total lag            | Общее отставание         | Производительность |

## Сервис MES Calculator
| Метрика                           | Назначение                                    | Тип мониторинга    |
| --------------------------------- | --------------------------------------------- | ------------------ |
| CPU %                             | Процент использования CPU                     | Система            |
| Memory Utilisation                | Процент использования памяти                  | Система            |
| Kb tranferred (received)          | Количество переданных байт                    | Система            |
| Kb provided (sent)                | Количество переданных байт                    | Система            |
| Number of requests (RPS)          | Количество запросов в секунду                 | Производительность |
| Response time (latency)           | Время ответа                                  | Производительность |
| Number of HTTP 200                | Количество HTTP 200                           | Производительность |
| Number of HTTP 500                | Количество HTTP 500                           | Производительность |
| Number of simultanious sessions   | Количество одновременных сессий               | Производительность |

## Сервис S3 Cloud Storage
| Метрика         | Назначение       | Тип мониторинга |
| --------------- | ---------------- | --------------- |
| Size of storage | Размер хранилища | Система         |

## Сервис MES Cache
| Метрика         | Назначение       | Тип мониторинга |
| --------------- | ---------------- | --------------- |
| Size of storage | Размер хранилища | Система         |

## 4. План действий

### 4.1 Реализовать экспорт метрик в Prometheus
4.1.1 Реализовать сбор метрик из сервисов системы описанных в разделе 3. Для сервисов CRM API, MES API, SHOP API использовать библиотеку Micrometer.
4.1.2 Реализовать преобразование собранных метрик в формат Prometheus
4.1.3 Реализовать экспозицию метрик, для возможности их доступными через конечную точку HTTP

### 4.2 Реализовать сбор метрик в Prometheus
4.2.1 Развернуть сервис Prometheus
4.2.2. Внести изменения в scrape_configs в файле prometheus.yml для сбора метрик от экспортеров
4.2.3 Для параметра scrape_interval установить значение 5s

### 4.3 Реализовать отображение метрик в Grafana
4.3.1 Развернуть сервис Grafana
4.3.2 Реализовать отображение собираемых метрик на дашбордах Grafana UI
4.3.3 Реализовать передачу алертов и отправку уведомлений при превышении пороговых значений
